<?php


$title='';$o='';$e='';$hjs='';$onload='';

//if (eregi('cms.php',sv('PHP_SELF')))die('Access Denied');

$pth['file']['execute']='./index.php';
$pth['folder']['content']='./content/';
$pth['file']['content']=$pth['folder']['content'].'content.htm';
$pth['file']['guestbook']=$pth['folder']['content'].'guestbook.txt';

if (@is_dir('./cmsimple/')) $pth['folder']['base']='./'; else $pth['folder']['base']='./../';

$pth['folder']['downloads']=$pth['folder']['base'].'downloads/';

$pth['folder']['images']=$pth['folder']['base'].'images/';
$pth['folder']['flags']=$pth['folder']['images'].'flags/';
$pth['folder']['editbuttons']=$pth['folder']['images'].'editor/';

$pth['folder']['cmsimple']=$pth['folder']['base'].'cmsimple/';
$pth['file']['image']=$pth['folder']['cmsimple'].'image.php';
$pth['file']['log']=$pth['folder']['cmsimple'].'log.txt';
$pth['file']['cms']=$pth['folder']['cmsimple'].'cms.php';
$pth['file']['config']=$pth['folder']['cmsimple'].'config.php';

if(!@include($pth['file']['config']))die('Config file missing');

initvar('image');
if ($image!=''){if(@include($pth['file']['image']))exit;}

$pth['folder']['language']=$pth['folder']['cmsimple'].'languages/';
if (preg_match('/\/[A-z]{2}\/[^\/]*/', sv('PHP_SELF'))) $sl=strtolower(preg_replace('/.*\/([A-z]{2})\/[^\/]*/','\1',sv('PHP_SELF')));
if (!isset($sl))$sl=$cf['language']['default'];
$pth['file']['language']=$pth['folder']['language'].$sl.'.php';

if(!@include($pth['file']['language']))die('Language file '.$pth['file']['language'].' missing');

$pth['folder']['templates']=$pth['folder']['base'].'templates/';
$pth['folder']['template']=$pth['folder']['templates'].$cf['site']['template'].'/';
$pth['file']['template']=$pth['folder']['template'].'template.htm';
$pth['file']['stylesheet']=$pth['folder']['template'].'stylesheet.css';
$pth['folder']['menubuttons']=$pth['folder']['template'].'menu/';
$pth['folder']['templateimages']=$pth['folder']['template'].'images/';

$ts='<table width="100%" cellpadding="1" cellspacing="0" border="0">';

if(strpos(sv('SERVER_SOFTWARE'),"IIS"))$sn=preg_replace('/([^\?]*)\?.*/','\1',sv('SCRIPT_NAME'));else $sn=preg_replace('/([^\?]*)\?.*/','\1',sv('REQUEST_URI'));

//COMMENT BY ADDONSBYDJOT// edited by Addonsbydjot - START
foreach(array('addonsbydjot', 'download','function','search','text','selected','login','logout','sitemap','settings','print','retrieve','file','mailform','guestbook','action','validate','images','downloads','edit','normal','stylesheet','passwd')as $i)initvar($i);
//COMMENT BY ADDONSBYDJOT// edited by Addonsbydjot - END
//COMMENT BY ADDONSBYDJOT// orignial CMSimple code - START
//foreach(array('download','function','search','text','selected','login','logout','sitemap','settings','print','retrieve','file','mailform','guestbook','action','validate','images','downloads','edit','normal','stylesheet','passwd')as $i)initvar($i);
//COMMENT BY ADDONSBYDJOT// orignial CMSimple code - END

if(sv('QUERY_STRING')!=''){$rq=explode('&',sv('QUERY_STRING'));$su=$rq[0];$v=count($rq);for($i=1;$i<$v;$i++)if($rq[$i]!='search='&&@$GLOBALS[preg_replace("/=.*/i","",$rq[$i])]=='')$GLOBALS[preg_replace("/=.*/i","",$rq[$i])]='true';} else $su=$selected;

// if(gc('status')!=''||$login){header('Cache-Control: no-cache');header('Pragma: no-cache');}

if($stylesheet!=''){header("Content-type: text/css");include($pth['file']['stylesheet']);exit;}
if($download!='')download($pth['folder']['downloads'].basename($download));

// LOGIN & BACKUP

$adm=(gc('status')=='adm'&&logincheck());if($login&&!$adm){if($cf['security']['wwwaut']!='true'){if($passwd==$cf['security']['password']){setcookie('status','adm');setcookie('passwd',$passwd);$adm=true;$edit=true;writelog(date("Y-m-d H:i:s")." from ".sv('REMOTE_ADDR')." logged_in\n");}else getlost();}else{if(sv('PHP_AUTH_USER')==''||sv('PHP_AUTH_PW')==''||gc('status')==''){
// In a future version of CMSimple this new Server API check will replace the setting of a variable
if($cf['security']['wwwaut']=='true'&&(php_sapi_name()=='cgi'||php_sapi_name()=='cgi-fcgi')){$e.='<li>security_wwwaut should only be set true, when Server API is apache - your is '.php_sapi_name().' - please see <a href="http://www.cmsimple.dk/?Requirements">http://www.cmsimple.dk/?Requirements</a>';}else{
setcookie('status','login');header('WWW-Authenticate: Basic realm="'.$tx['login']['warning'].'"');getlost();}}else{if(logincheck()){setcookie('status','adm');$adm=true;$edit=true;writelog(date($tx['log']['dateformat']).' '.sv('REMOTE_ADDR').' '.$tx['log']['loggedin']."\n");}else{getlost();}}}}else if($logout&&$adm){$fn=date("YmdHis").'.htm';if(@copy($pth['file']['content'],$pth['folder']['content'].$fn)){$o.='<p>'.ucfirst($tx['filetype']['backup']).' '.$fn.' '.$tx['result']['created'].'</p>';$fl=array();$fd=@opendir($pth['folder']['content']);while(($p=@readdir($fd))==true){if(preg_match("/\d{3}\.htm/",$p))$fl[]=$p;}if($fd==true)closedir($fd);@sort($fl,SORT_STRING);$v=count($fl)-$cf['backup']['numberoffiles'];for($i=0;$i<$v;$i++){if(@unlink($pth['folder']['content'].'/'.$fl[$i]))$o.='<p>'.ucfirst($tx['filetype']['backup']).' '.$fl[$i].' '.$tx['result']['deleted'].'</p>';else e('cntdelete','backup',$fl[$i]);}}else e('cntsave','backup',$fn);$adm=false;setcookie('status','');setcookie('passwd','');$o.='<p><font color="red">'.$tx['login']['loggedout'].'</font></p>';}

// SETTING FUNCTIONS AS PERMITTED

if($adm){

if($edit)setcookie('mode','edit');if($normal)setcookie('mode','');if(gc('mode')=='edit'&&!$normal)$edit=true;}

else{if(gc('status')!='')setcookie('status','');if(gc('mode')=='edit')setcookie('mode','');
// Script for javascript login()
if($cf['security']['wwwaut']!='true'&&!$print&&!$retrieve)$hjs='<script type="text/javascript"><!--
function login(){var t=prompt("'.$tx['login']['warning'].'","");if(t!=null&&t!=""){document.getElementById("passwd").value=t;document.getElementById("login").submit();}}
//-->
</script>';}

$cl=0;
rfc();

$f='';
$pth['folder']['plugins']=$pth['folder']['base'].'plugins/';
         include($pth['folder']['plugins'].'index.php'); 
if($sitemap)$f='sitemap';
if($mailform||$function=='mailform')$f='mailform';
if($guestbook||$function=='guestbook')$f='guestbook';
if($function=='search')$f='search';

if($adm){
//COMMENT BY ADDONSBYDJOT// added by Addonsbydjot - START
if($addonsbydjot)$f='addonsbydjot';
//COMMENT BY ADDONSBYDJOT// added by Addonsbydjot - END
if($validate)$f='validate';
if($settings)$f='settings';
if($file)$f='file';
if($images||$function=='images')$f='images';
if($downloads||$function=='downloads')$f='downloads';
if($function=='save')$f='save';
}

if($s==-1&&!$f&&$o==''){if($su!=''){header('status: 404 Not Found');$title=$tx['error']['404'];$o='<map id="q"><h1>'.$title.'</h1></map>'.$o;}else{$s=0;$hs=0;}}

//COMMENT BY ADDONSBYDJOT// added by Addonsbydjot - START
include('./addonsbydjot/addonsbydjot.config.php');
include('./'.$GLOBALS['abdj_filename_addonsbydjot']);
include_once('./'.$GLOBALS['abdj_file_common_functions']);
abdj_CSS('file', $GLOBALS['abdj_file_css_addonsbydjot']);
//COMMENT BY ADDONSBYDJOT// added by Addonsbydjot - END
//COMMENT BY ADDONSBYDJOT// added by Addonsbydjot - START
if(!$adm){abdj_Counter_CountPage($su);}
//COMMENT BY ADDONSBYDJOT// added by Addonsbydjot - END

// CMSimple scripting
if(!($edit&&$adm)&&$s>-1){$t=preg_replace("/^.*\#CMSimple (.*)\#.*$/is","\\1",$c[$s]);if($t!=''&&$t!=$c[$s]&&$t!='remove'&&$t!='hide'){$output=preg_replace("/\#CMSimple.*\#/is","",$c[$s]);@eval(preg_replace(array("'&(quot|#34);'i","'&(amp|#38);'i","'&(lt|#60);'i","'&(gt|#62);'i","'&(nbsp|#160);'i"),array("\"","&","<",">"," "),$t));$c[$s]=$output;if(isset($keywords))$cf['meta']['keywords']=$keywords;if(isset($description))$cf['meta']['description']=$description;};}

// Public functions

if($f=='search'){$title=$tx['title']['search'];$ta=array();for($i=0;$i<$hl;$i++){if(@preg_match('/'.preg_quote($search,'/').'/i',$c[$hc[$i]]))$ta[]=$hc[$i];}$o.='<h1>'.$tx['search']['result'].'</h1><p>"'.htmlspecialchars(stripslashes($search)).'" ';if(count($ta)==0)$o.=$tx['search']['notfound'].'.';else{$o.=$tx['search']['foundin'].' '.count($ta). ' ';if(count($ta)>1)$o.=$tx['search']['pgplural'];else $o.=$tx['search']['pgsingular'];$o.=':';}$o.='</p>'.li($ta,'search');}

if($f=='sitemap'||$f=='mailform'||$f=='guestbook'){ $title=$tx['title'][$f];$o.='<h1>'.$title.'</h1>'; }

if($f=='sitemap')$o.=li($hc,'sitemaplevel');

if($f=='mailform'){initvar('sender');$t='';if($action=='send'){if($mailform=='true'||$mailform=='')$e.='<li>'.$tx['error']['mustwritemes'];else if(!(eregi("^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[_a-z0-9-]+(\.[_a-z0-9-]+)*(\.([a-z]{2,4}))+$",$sender)))$e.='<li>'.$tx['error']['mustwritemail'].'.';else if(!(@mail($cf['mailform']['email'],'Mailform from '.sv('SERVER_NAME'),$mailform,"From: ".$sender."\r\n"."X-Remote: ".sv('REMOTE_ADDR')."\r\n")))$e.='<li>'.$tx['mailform']['notsend'];else $t='<p>'.$tx['mailform']['send'].'</p>';}if($t==''||$e!=''){$o.='<form action="'.$sn.'" method="post"><textarea rows="6" cols="40" name="mailform">';if($mailform!='true')$o.=$mailform;$o.='</textarea>'.tag('input type="hidden" name="function" value="mailform"').tag('input type="hidden" name="action" value="send"').tag('br').$tx['mailform']['sender'].': '.tag('input type="text" class="text" name="sender" value="'.$sender.'"').' '.tag('input type="submit" class="submit" value="'.$tx['mailform']['sendbutton'].'"').'</form>';}else $o.=$t;}

if($f=='guestbook'){$t=rmnl(rf($pth['file']['guestbook']));if($action=='save'){if($guestbook=='')$e.='<li>'.$tx['error']['mustwritemes'];else if(strlen($guestbook)>$cf['guestbook']['maxlength'])$e.='<li>'.$tx['guestbook']['maxlength'].': '.$cf['guestbook']['maxlength'];else{if($fh=@fopen($pth['file']['guestbook'],"w")){fwrite($fh,"<hr>\n<small>".$tx['guestbook']['posted'].' '.date($tx['guestbook']['dateformat'],time()).' '.$tx['guestbook']['from'].' '.sv('REMOTE_ADDR').'</small>:'.tag('br')."\n".htmlspecialchars(rmnl(stripslashes($guestbook))).$t);fclose($fh);$t=rmnl(rf($pth['file']['guestbook']));}else e('cntwriteto','guestbook',$pth['file']['guestbook']);}}$o.='<form action="'.$sn.'" method="post"><textarea rows="6" cols="40" name="guestbook">';if($e!='')$o.=stripslashes($guestbook);$o.='</textarea>'.tag('input type="hidden" name="function" value="guestbook"').tag('input type="hidden" name="action" value="save"').tag('br').' '.tag('input type="submit" class="submit" value="'.$tx['guestbook']['sendbutton'].'"').'</form>'.$t;}

// Protected functions
if($adm){

//COMMENT BY ADDONSBYDJOT// added by Addonsbydjot - START
if($f == 'addonsbydjot'){$o.=require("./".$GLOBALS['abdj_filename_addonsbydjot']);}
//COMMENT BY ADDONSBYDJOT// added by Addonsbydjot - END

if($f=='settings'||$f=='images'||$f=='downloads'||$f=='validate'){ $title=$tx['title'][$f];$o.='<h1>'.$title.'</h1>'; }

// SETTINGS

if($f=='settings'){$o.='<p>'.$tx['settings']['warning'].'</p><h4>'.$tx['settings']['systemfiles'].'</h4><ul>';foreach(array('config','language') as $i)$o.='<li><a href="'.$sn.'?file='.$i.amp().'action=array">'.ucfirst($tx['action']['edit']).' '.$tx['filetype'][$i].'</a>';foreach(array('stylesheet','template','guestbook') as $i)$o.='<li><a href="'.$sn.'?file='.$i.amp().'action=edit">'.ucfirst($tx['action']['edit']).' '.$tx['filetype'][$i].'</a>';foreach(array('log') as $i)$o.='<li><a href="'.$sn.'?file='.$i.amp().'action=view">'.ucfirst($tx['action']['view']).' '.$tx['filetype'][$i].'</a>';foreach(array('content') as $i)$o.='<li>'.ucfirst($tx['filetype'][$i]).' <a href="'.$sn.'?file='.$i.amp().'action=view">'.$tx['action']['view'].'</a>'.' <a href="'.$sn.'?file='.$i.'">'.$tx['action']['edit'].'</a>'.' <a href="'.$sn.'?file='.$i.amp().'action=download">'.$tx['action']['download'].'</a>';$o.='</ul><h4>'.$tx['settings']['backup'].'</h4><p>'.$tx['settings']['backupexplain1'].'</p><p>'.$tx['settings']['backupexplain2'].'</p><ul>';$fs=sortdir($pth['folder']['content']);foreach($fs as $p)if(preg_match("/\d{3}\.htm/",$p))$o.='<a href="'.$sn.'?file='.$p.amp().'action=view"><li>'.$p.'</a> ('.(round((filesize($pth['folder']['content'].'/'.$p))/102.4)/10).' KB)';$o.='</ul>';ftp('content');}

if($f=='images'||$f=='downloads'){if($f=='images')$reg="/\.gif$|\.jpg$|\.jpeg$|\.png$/i";else $reg="/^[^\.]/i";if($action=='delete'){if(!(preg_match($reg,$GLOBALS[$f])))e('wrongext','file',$GLOBALS[$f]);else{if(@unlink($pth['folder'][$f].$GLOBALS[$f]))$o.='<p>'.ucfirst($tx['filetype']['file']).' '.$GLOBALS[$f].' '.$tx['result']['deleted'].'</p>';else e('cntdelete','file',$GLOBALS[$f]);}}if($action=='upload'){$name=im($f,'name');$size=im($f,'size');if(!(preg_match($reg,$name)))e('wrongext','file',$name);else if(file_exists(rp($pth['folder'][$f].$name)))e('alreadyexists','file',$name);else if($size>$cf[$f]['maxsize'])$e.='<li>'.ucfirst($tx['filetype']['file']).' '.$name.' '.$tx['error']['tolarge'].' '.$cf[$f]['maxsize'].' '.$tx['files']['bytes'];if(!$e){if(@move_uploaded_file(im($f,'tmp_name'),$pth['folder'][$f].$name))$o.='<p>'.ucfirst($tx['filetype']['file']).' '.$name.' '.$tx['result']['uploaded'].'</p>';else e('cntsave','file',$name);}}if($cf[$f]['maxsize']>0)$o.='<form method="POST" action="'.$sn.'" enctype="multipart/form-data"><p>'.tag('input type="file" class="file" name="'.$f.'" size="30"').tag('input type="hidden" name="action" value="upload"').' '.tag('input type="hidden" name="function" value="'.$f.'"').tag('input type="submit" class="submit" value="'.ucfirst($tx['action']['upload']).'"').'</p></form>';$o.='<form method="post" action='.$sn.'><table width="100%" cellpadding="5" cellspacing="0" border="0">';$totalsize=0;
if(@is_dir($pth['folder'][$f])){$fs=sortdir($pth['folder'][$f]);foreach($fs as $p)
{if(preg_match($reg,$p)){$totalsize+=filesize($pth['folder'][$f].$p);$o.='<tr><td>'.tag('input type="radio" class="radio" name="'.$f.'" value="'.$p.'"').'</td><td>';if($f=='images')$o.='<img src="'.$pth['folder'][$f].$p.'">'.tag('br');$o.=$p.' ('.(round((filesize($pth['folder'][$f].$p))/102.4)/10).' KB)';if($f=='images'){for($i=0;$i<$cl;$i++){$ic=preg_match_all('/<img src=["]*([^"]*?)'.'\/'.$p.'["]*(.*?)>/i',$c[$i],$matches,PREG_PATTERN_ORDER);if($ic>0)$o.=tag('br').$tx[$f]['usedin'].' '.a($i,'').$h[$i].'</a>';}}$o.='</td></tr>';}}$o.='</table>'.tag('br').tag('input type="hidden" name="action" value="delete"').tag('input type="hidden" name="function" value="'.$f.'"');if($totalsize>0)$o.=tag('input type="submit" class="submit" value="'.ucfirst($tx['action']['delete']).'"');$o.='</form>';$o.='<p>'.$tx['files']['totalsize'].': '.(round($totalsize/102.4)/10).' KB</p>';}else e('cntopen','folder',$pth['folder'][$f]);ftp($f);}

if($f=='file'){if(preg_match("/\d{3}\.htm/",$file))$pth['file'][$file]=$pth['folder']['content'].'/'.$file;if($pth['file'][$file]!=''){if($action=='view'){header('Content-Type: text/plain');echo rmnl(rf($pth['file'][$file]));exit;}if($action=='download'){download($pth['file'][$file]);}else{initvar('form');if($action=='array') $form='array';if($form=='array'){if($file=='language')$a='tx';if($file=='config')$a='cf';}if($action=='save'){if($form=='array'){$text="<?php\n";foreach($GLOBALS[$a] as $k1=>$v1){if(is_array($v1)){foreach($v1 as $k2=>$v2){if(!is_array($v2)){initvar($k1.'_'.$k2);$GLOBALS[$a][$k1][$k2]=stripslashes($GLOBALS[$k1.'_'.$k2]);if($k1.$k2=='editorbuttons')$text.='$'.$a.'[\''.$k1.'\'][\''.$k2.'\']=\''.$GLOBALS[$a][$k1][$k2].'\';'; else $text.='$'.$a.'[\''.$k1.'\'][\''.$k2.'\']="'.preg_replace("/\"/s","",$GLOBALS[$a][$k1][$k2]).'";'."\n";}}}}$text.='?>';}else $text=rmnl(stripslashes($text));if($fh=@fopen($pth['file'][$file],"w")){fwrite($fh,$text);fclose($fh);if($file=='config'||$file=='language'){if(!@include($pth['file'][$file]))e('cntopen',$file,$pth['file'][$file]);if($file=='config'){$pth['folder']['template']=$pth['folder']['templates'].$cf['site']['template'].'/';$pth['file']['template']=$pth['folder']['template'].'template.htm';$pth['file']['stylesheet']=$pth['folder']['template'].'stylesheet.css';$pth['folder']['menubuttons']=$pth['folder']['template'].'menu/';$pth['folder']['templateimages']=$pth['folder']['template'].'images/';if(!(preg_match('/\/[A-z]{2}\/[^\/]*/', sv('PHP_SELF')))){$sl=$cf['language']['default'];$pth['file']['language']=$pth['folder']['language'].$sl.'.php';if(!@include($pth['file']['language']))die('Language file '.$pth['file']['language'].' missing');}}}}else e('cntwriteto',$file,$pth['file'][$file]);}chkfile($file,true);$title=ucfirst($tx['action']['edit']).' '.$tx['filetype'][$file];$o.='<h1>'.$title.'</h1><form action="'.$sn.'" method="post">';if($form=='array'){$o.=$ts;foreach($GLOBALS[$a] as $k1=>$v1){$o.='<tr><td colspan="2"><h4>'.ucfirst($k1).'</h4></td></tr>';if(is_array($v1))foreach($v1 as $k2=>$v2)if(!is_array($v2)){if(isset($tx['help'][$k1.'_'.$k2])&&$a=='cf')$o.='<tr><td colspan="2"><b>'.$tx['help'][$k1.'_'.$k2].':</b></td></tr>';$o.='<tr><td valign="top">'.$k1.'_'.$k2.':</td><td>';if($k1.$k2=='editorbuttons')$o.='<textarea rows="25" cols="35" name="'.$k1.'_'.$k2.'">'.$v2.'</textarea>'; else if($k1.$k2=='languagedefault')selectlist('language',"/^[a-z]{2}\.php$/i","/^([a-z]{2})\.php$/i"); else if($k1.$k2=='sitetemplate')selectlist('templates',"/^[^\.]*$/i","/^([^\.]*)$/i");else $o.=tag('input type="text" class="text" name="'.$k1.'_'.$k2.'" value="'.$v2.'" size="50"');$o.='</td></tr>';}}$o.='</table>'.tag('input type="hidden" name="form" value="'.$form.'"');} else $o.='<textarea rows="25" cols="50" name="text">'.rmnl(rf($pth['file'][$file])).'</textarea>';$o.=tag('input type="hidden" name="file" value="'.$file.'"').tag('input type="hidden" name="action" value="save"').' '.tag('input type="submit" class="submit" value="'.ucfirst($tx['action']['save']).'"').'</form>';}}}

if($f=='validate'){@set_time_limit(0);for($i=0;$i<$cl;$i++){$ic=preg_match_all('/<a(.*?)href=["]*([^"]*)["]*(.*?)>(.*?)<\/a>/i',$c[$i],$ms,PREG_PATTERN_ORDER);if($ic>0){$o.='<h4>'.a($i,'').h($i).'</a> - '.$ic.' link';if($ic>1)$o.='s';$o.=':</h4>';for($j=0;$j<$ic;$j++){$o.='<p>'.$ms[0][$j].tag('br').$ms[2][$j].tag('br');if(trim(strip_tags($ms[0][$j]))=='')$o.='<font color="red">'.$tx[$f]['notxt'].'</font> ';if(preg_match('/^http/i',$ms[2][$j])){$tu=parse_url($ms[2][$j]);$doc=$tu['path'];if(isset($tu['query']))$doc.='?'.$tu['query'];if($fh=@fsockopen($tu['host'],80,$en,$es,5)){$t='';fputs ($fh,"HEAD ".$doc." HTTP/1.0\r\nHost: ".$tu['host']."\r\n\r\n");if(function_exists("socket_set_timeout"))socket_set_timeout($fh,5);else if(function_exists("stream_set_timeout"))stream_set_timeout($fh,5);$t=fread($fh,12);fclose($fh);$t=preg_replace("/HTTP\/.\.. /i","",$t);if($t==200)$o.='<font color="green">'.$tx[$f]['extok'].'</font>';else $o.='<font color="red">'.$tx[$f]['extfail'].'</font>';}else $o.='<font color="red">'.$tx[$f]['extfail'].'</font>';}else{if(preg_match('/^mailto/i',$ms[2][$j]))$o.='<font color="orange">'.$tx[$f]['mailto'].'</font>';else{$m=false;for($k=0;$k<$cl;$k++){if($ms[2][$j]==$sn.'?'.$u[$k])$m=true;}if($m)$o.='<font color="green">'.$tx[$f]['intok'].'</font>';else{if(chkdl($ms[2][$j]))$o.='<font color="green">'.$tx[$f]['intfilok'].'</font>';else $o.='<font color="red">'.$tx[$f]['intfail'].'</font>';}}}$o.='</p>';}}}}

// SAVE

if($f=='save'){

$ss=$s;$c[$s]=preg_replace("/<h[1-3][^>]*>(\&nbsp;| )?<\/h[1-3]>/i","",stripslashes($text));if($s==0)if(!preg_match("/^(\n)?<h1[^>]*>.*<\/h1>/i",rmnl($c[0]))&&!preg_match("/^(<p[^>]*>)?(\&nbsp;| |<br \/>)?(<\/p>)?(\n)?$/i",rmnl($c[0])))$c[0]='<h1>'.$tx['toc']['missing'].'</h1>'.$c[0];$title=ucfirst($tx['filetype']['content']);if($fh=@fopen($pth['file']['content'],"w")){fwrite($fh,'<html><head>'.head().'</head><body>'."\n");foreach($c as $i){fwrite($fh,rmnl($i."\n"));}fwrite($fh,'</body></html>');fclose($fh);rfc();}else e('cntwriteto','content',$pth['file']['content']);$title='';}

// EDITOR CALL

if($edit&&(!$f||$f=='save')&&!$download){
if($s<0&&$ss<$cl)$s=$ss;if($s>-1){$su=$u[$s];$iimage='';
if($cf['editor']['external']!=''){if(!@include($pth['folder']['cmsimple'].$cf['editor']['external'].'.php'))$e.='<li>External editor missing';}else{

// OEdit (build in Editor)
if (@$tx['editor']['buttons']!=''){

if(@is_dir($pth['folder']['images'])){$fs=sortdir($pth['folder']['images']);foreach($fs as $p){if(preg_match("/\.gif$|\.jpg$|\.jpeg$|\.png$/i",$p)){if($iimage!='')$iimage.=',';$iimage.='["'.$pth['folder']['images'].$p.'","'.substr($p,0,30).'"]';}}}else{$iimage.='["","'.$tx['error']['cntopen'].' '.$pth['folder']['images'].'"]';}if($iimage=='')$iimage.='["","'.$tx['editor']['noimages'].' '.$pth['folder']['images'].'"]';$ilink='';for($i=0;$i<$cl;$i++){if($ilink!='')$ilink.=',';$ilink.='["'.$sn.'?'.$u[$i].'","'.substr(str_replace('"','&quot;',$h[$i]),0,30).'"]';}if(@is_dir($pth['folder']['downloads'])){$fs=sortdir($pth['folder']['downloads']);foreach($fs as $p){if(preg_match("/.+\..+$/",$p)){if($ilink!='')$ilink.=',';$ilink.='["'.$sn.'?download='.$p.'","(File '.(round((filesize($pth['folder']['downloads'].'/'.$p))/102.4)/10).' KB)'.' '.substr($p,0,25).'"]';}}}if(@is_dir($pth['folder']['editbuttons']))$getimage='"'.$pth['folder']['editbuttons'].'"+image+".gif"'; else $getimage='"'.$sn.'?image="+image';$onload.=' onload="init()"';
$hjs='<script type="text/javascript">
// OEdit Ver. 3.6 - © 2004 Peter Andreas Harteg - http://www.harteg.dk
var copyright="CMSimple - http://www.cmsimple.dk"; var changemode="'.$tx['editor']['changemode'].'";var btns='.$tx['editor']['buttons'].';var iimage=['.$iimage.'];var ilink=['.$ilink.'];function getimage(image){return '.$getimage.'}var format="HTML";var isNav=(navigator.appName=="Netscape");function init(){document.getElementById("f").contentWindow.document.designMode="on";document.getElementById("f").contentWindow.focus();window.status=copyright}function chmode(){if(format=="HTML"){if(isNav){var html=document.createTextNode(document.getElementById("f").contentWindow.document.body.innerHTML);with(document.getElementById("f").contentWindow.document.body){innerHTML="";appendChild(html)}}else{with(document.getElementById("f").contentWindow){with(document.body){style.fontFamily="Courier";style.fontSize="10pt";innerText=innerHTML}focus();document.body.createTextRange().collapse(false)}}document.getElementById("html").src=img2.src;format="Text"}else{if(isNav){var html=document.getElementById("f").contentWindow.document.body.ownerDocument.createRange();html.selectNodeContents(document.getElementById("f").contentWindow.document.body);document.getElementById("f").contentWindow.document.body.innerHTML=html.toString()}else{with(document.getElementById("f").contentWindow){with(document.body){innerHTML=innerText;style.fontFamily="";style.fontSize=""}focus();document.body.createTextRange().collapse(false)}}document.getElementById("html").src=img1.src;format="HTML"}}function cmd(c){if(c=="save"){if(format=="HTML"){document.getElementById("text").value=document.getElementById("f").contentWindow.document.body.innerHTML;document.getElementById("ta").submit()}else if(confirm(changemode))chmode()}else if(c=="selectall")document.getElementById("f").contentWindow.document.execCommand(c,false,null);else if(c=="html")chmode();else{if(format=="HTML"||(c=="cut"||c=="copy"||c=="paste"||c=="undo"||c=="redo")){var t=null;if(c=="iimage"){t=document.forms[c].iimage.value;c="insertimage"}if(c=="ilink"){t=document.forms[c].ilink.value;c="createlink"}if((c.search(/h[1-4]/)!=-1)||c=="p"){t="<"+c+">";c="formatblock"}document.getElementById("f").contentWindow.focus();if(t==null&&c=="createlink"){if(isNav){t=prompt("Enter URL:","");document.getElementById("f").contentWindow.document.execCommand("CreateLink",false,t)}else document.getElementById("f").contentWindow.document.selection.createRange().execCommand(c,true,t)}else if(c=="cut"||c=="copy"||c=="paste")document.getElementById("f").contentWindow.document.selection.createRange().execCommand(c,false,null);else document.getElementById("f").contentWindow.document.execCommand(c,false,t);document.getElementById("f").contentWindow.focus();}}}function tables(){for(var i=0;i<btns.length;i++){if(btns[i][0]=="ilink")sb(i,ilink);if(btns[i][0]=="iimage")sb(i,iimage);if(btns[i][0]=="tr")document.write("</td></tr></table></td></tr><tr><td><table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"><tr><td>");else{if(btns[i][0]!="")document.write("<img src=\""+getimage(btns[i][0])+"\" id=\""+btns[i][0]+"\" alt=\""+btns[i][1]+"\" title=\""+btns[i][1]+"\" onclick=\"cmd(\'"+btns[i][0]+"\')\" width=\"23\" height=\"22\" style=\"border:outset 1px;\" onmouseover=\"this.style.border=\'inset 1px\';window.status=\'"+btns[i][2]+"\'\" onmouseout=\"this.style.border=\'outset 1px\';window.status=\'"+copyright+"\'\">");else document.write("<img src=\""+getimage(btns[i][0])+"\" alt=\"\" width=\"3\" height=\"22\">")}}}function sb(i,t){document.write("</td><td><form id=\""+btns[i][0]+"\"><select id=\""+btns[i][0]+"\">");for(var j=0;j<t.length;j++)document.write("<option value=\""+ t[j][0]+"\">"+t[j][1]+"</option>");document.write("</select></form></td><td>")}function bloker(){return false}document.ondragstart=bloker;img1=new Image();img1.src=getimage("html");img2=new Image();img2.src=getimage("layout");</script>';
$o.='<table class="edit" width=100% border="1" cellpadding="0" cellspacing="0"><tr><td><table border="0" cellpadding="0" cellspacing="0"><tr><td><script type="text/javascript">tables();</script></td></tr></table></td></tr><tr><td><script type="text/javascript">
document.write(\'<iframe id="f" src="'.$sn.'?'.$su.'&retrieve=\'+((new Date()).getTime())+\'" width="100%" height="\'+('.$cf['editor']['height'].')+\'"></iframe>\');
</script></td></tr></table><p style="visibility:hidden;position:absolute;left:0;top:0"><form method="post" id="ta" action="'.$sn.'">'.tag('input type="hidden" name="selected" value="'.$u[$s].'"').tag('input type="hidden" name="function" value="save"').'<textarea name="text" id="text" style="width: 0;height: 0;visibility: hidden;"></textarea></form></p>';
}}}else $o='<p>'.$tx['error']['cntlocateheading'].'</p>';}
}// end protected

foreach(array('content','config','language','stylesheet','template','guestbook','log') as $i)chkfile($i,(($login||$settings)&&$adm));
if($e)$o='<h1>'.$tx['heading']['warning'].'</h1><ul>'.$e.'</ul>'.$o;
if($title==''){if($s>-1)$title=$h[$s];else if($f!='')$title=ucfirst($f);}
if($retrieve){echo '<html><head>'.head().'</head><body class="retrieve">'.$c[$s].'</body></html>';exit;}
if($print){echo '<html><head>'.head().'</head><body class="print"'.onload().'>'.content().'</body></html>';exit;}

if(!@include($pth['file']['template']))echo '<html><head><title>'.$tx['heading']['error'].'</title></head><body>'.$o.'</body></html>';

// INTERNAL FUNCTIONS

function initvar($name){if(!isset($GLOBALS[$name])) {if (isset($_GET[$name])) $GLOBALS[$name]=$_GET[$name]; else if (isset($_POST[$name])) $GLOBALS[$name]=$_POST[$name]; else $GLOBALS[$name]=@preg_replace("/.*?(".$name."=([^\&]*))?.*?/i","\\2",$GLOBALS['HTTP_SERVER_VARS']['QUERY_STRING']);}}

function sv($s){global $HTTP_SERVER_VARS; // if phpversion() above 4.1 you might want to use $_SERVER
if(isset($HTTP_SERVER_VARS[$s]))return $HTTP_SERVER_VARS[$s];else return'';}

function im($n,$p){global $HTTP_POST_FILES; // if phpversion() above 4.1 you might want to use $_FILES
if(isset($HTTP_POST_FILES[$n][$p]))return $HTTP_POST_FILES[$n][$p];else return'';}

function gc($s){global $HTTP_COOKIE_VARS;if(isset($HTTP_COOKIE_VARS[$s]))return $HTTP_COOKIE_VARS[$s];}

function logincheck(){global $cf;if($cf['security']['wwwaut']=='true')return (sv('PHP_AUTH_USER')==$cf['security']['username']&&sv('PHP_AUTH_PW')==$cf['security']['password']);else return (gc('passwd')==$cf['security']['password']);}

function writelog($m){global $pth,$e;if($fh=@fopen($pth['file']['log'],"a")){fwrite($fh,$m);fclose($fh);}else {e('cntwriteto','log',$pth['file']['log']);chkfile('log',true);}}

function rmnl($text){return preg_replace("/(\r\n|\r|\n)+/","\n",$text);}

function getlost(){global $o,$title,$tx;header('status: 401 Unauthorized');$title=$tx['error']['401'];$o='<h1>'.$title.'</h1>'.$o;}

function download($fl){global $sn,$download;if(!is_readable($fl)||($download!=''&&!chkdl($sn.'?download='.basename($fl)))){global $o,$text_title;header('status: 404 Not Found');$title=$tx['error']['404'];$o='<h1>'.$title.'</h1><p>File '.$fl.'</p>'.$o;return;}else{header('Content-Type: application/save-as');header('Content-Disposition: attachment; filename="'.basename($fl).'"');header('Content-Length:'.filesize($fl));header('Content-Transfer-Encoding: binary');if($fh=@fopen($fl,"rb")){while(!feof($fh))echo fread($fh,filesize($fl));fclose($fh);}exit;}}

function chkdl($fl){global $pth,$sn;$m=false;if(@is_dir($pth['folder']['downloads'])){$fd=@opendir($pth['folder']['downloads']);while(($p=@readdir($fd))==true){if(preg_match("/.+\..+$/",$p)){if($fl==$sn.'?download='.$p)$m=true;}}if($fd==true)closedir($fd);}return $m;}

function rf($fl){$fl=@rp($fl);if(!file_exists($fl))return;clearstatcache();if(function_exists('file_get_contents'))return file_get_contents($fl);else{return join("\n",file($fl));}}

function chkfile($fl,$writable){global $pth,$tx;$t=@rp($pth['file'][$fl]);if($t=='')e('undefined','file',$fl);else if(!file_exists($t))e('missing',$fl,$t);else if(!is_readable($t))e('notreadable',$fl,$t);else if(!is_writable($t)&&$writable)e('notwritable',$fl,$t);}

function e($et,$ft,$fn){global $e,$tx;$e.='<li>'.$tx['error'][$et].' '.$tx['filetype'][$ft].' '.$fn;}

function rfc(){global $c,$cl,$h,$u,$l,$docstart,$su,$s,$pth,$tx,$edit,$adm,$cf,$hc,$hs,$hl;$c=array();$h=array();$u=array();$l=array();$hc=array();$c=explode('§',preg_replace("/(<h[1-3][^>]*>)/i","§\\1",str_replace('§','&#167;',rf($pth['file']['content']))));$docstart='';if(h(0)=='')$docstart.=array_shift($c);if(count($c)==0)$c[0]='<h1>'.$tx['toc']['newpage'].'</h1>';if(!preg_match("/^<h1[^>]*>.*<\/h1>/is",$c[0]))$c[0]='<h1>'.$tx['toc']['missing'].'</h1>'.$c[0];$c[count($c)-1]=preg_replace("/(.*)<\/body>.*<\/html>/i","\\1",$c[count($c)-1]);$duplicate=1;$empty=1;$l1='';$l2='';$s=-1;$hs=-1;if(!($edit&&$adm)){foreach($c as $i=>$j){if(preg_match("/\#CMSimple remove\#/is",$j))unset($c[$i]);}$c=array_values($c);}$cl=count($c);for($i=0;$i<$cl;$i++){$h[$i]=h($i);$l[$i]=l($i);if($h[$i]==''){$h[$i]=$tx['toc']['empty'].' '.$empty++;$u[$i]=$h[$i];}if($l[$i]==1){$l1=uenc($h[$i]);$u[$i]=$l1;}if($l[$i]==2){$l2=uenc($h[$i]);$u[$i]=$l1.$cf['uri']['seperator'].$l2;}if($l[$i]==3){$u[$i]=$l1.$cf['uri']['seperator'].$l2.$cf['uri']['seperator'].uenc($h[$i]);}$w=count($u)-1;for($j=0;$j<$w;$j++){if($u[$i]==$u[$j]){$h[$i]=$tx['toc']['dupl'].' '.$duplicate++;$u[$i]=uenc($h[$i]);}}if(($edit&&$adm)||(!preg_match("/\#CMSimple hide\#/is",$c[$i]))){$hc[]=$i;if($su==$u[$i])$hs=count($hc)-1;}if($su==$u[$i])$s=$i;}$hl=count($hc);}

function h($n){global $c;return trim(strip_tags(preg_replace("/(<h[1-3][^>]*>([^§]*?)<\/h[1-3]>)?[^¶]*/i","\\2",$c[$n])));}

function l($n){global $c;if(isset($c[$n]))return preg_replace("/<h([1-3])[^>]*>[^§]*/i","\\1",$c[$n]);else return 0;}

function a($i,$x){global $sn,$u;return '<a href="'.$sn.'?'.$u[$i].$x.'">';}

function selectlist($fn,$regm,$regr){global $k1,$k2,$v2,$o,$pth;$o.='<select name="'.$k1.'_'.$k2.'">';if($fd=@opendir($pth['folder'][$fn])){while(($p=@readdir($fd))==true){if(preg_match($regm,$p)){$v=strtolower(preg_replace($regr,"\\1",$p));$o.='<option value="'.$v.'"';if ($v==$v2) $o.=' selected="selected"';$o.='>'.$v.'</option>';}}closedir($fd);}$o.='</select>';}

function ftp($f){global $o,$cf,$pth,$tx;$o.='<p>';if($cf['files']['ftp']!=''&&@is_dir($pth['folder'][$f]))$o.='<a href="'.$cf['files']['ftp'].$pth['folder'][$f].'" target="_blank">';$o.=$tx['settings']['ftp'];if($cf['files']['ftp']!=''&&@is_dir($pth['folder'][$f]))$o.='</a>';$o.='</p>';}

function meta($n){global $cf;if($cf['meta'][$n]!='')return tag('meta name="'.$n.'" content="'.$cf['meta'][$n].'"')."\n";}

function ml($i){global $f,$sn,$tx;$t='';if($f!=$i)$t.='<a href="'.$sn.'?'.amp().$i.'">';$t.=$tx['menu'][$i];if($f!=$i)$t.='</a>';return $t;}

function uenc($s){return str_replace('+','_',urlencode($s));}

function rp($p){if(@realpath($p)=='')return $p;else return realpath($p);}

function sortdir($dir){$fs=array();$fd=@opendir($dir);while(false!==($fn=@readdir($fd))){$fs[]=$fn;}if($fd==true)closedir($fd);@sort($fs,SORT_STRING);return $fs;}

// For valid XHTML
function tag($s){global $cf;$t='';if($cf['xhtml']['endtags']=='true')$t=' /';return '<'.$s.$t.'>';}
function amp(){global $cf;if($cf['xhtml']['amp']=='true')return '&amp;';else return('&');}

// #CMSimple functions to use within content

function geturl($u){$t='';if($fh=@fopen(preg_replace("/\&amp;/is","&",$u),"r")){while(!feof($fh))$t.=fread($fh, 1024);fclose($fh);return preg_replace("/.*<body[^>]*>(.*)<\/body>.*/is","\\1",$t);}}

function geturlwp($u){global $su;$t='';if($fh=@fopen(($u.'?'.preg_replace("/^".preg_replace("/\+/s","\\\+",preg_replace("/\//s","\\\/",$su))."(\&)?/s","",sv('QUERY_STRING'))),"r")){while(!feof($fh))$t.=fread($fh, 1024);fclose($fh);
return $t;}}

function autogallery($u) {global $su;return preg_replace("/.*<!-- autogallery -->(.*)<!-- \/autogallery -->.*/is","\\1",preg_replace("/(option value=\"\?)(p=)/is","\\1".$su."&\\2",preg_replace("/(href=\"\?)/is","\\1".$su.amp(),preg_replace("/(src=\")(\.)/is","\\1".$u."\\2",geturlwp($u)))));}

// Other functions

function newsbox($b){global $c,$cl,$h;for($i=0;$i<$cl;$i++)if($h[$i]==$b)return preg_replace("/\#CMSimple.*\#/is","",preg_replace("/.*<\/h[1-3]>/i", "",$c[$i]));}

// PAGE FUNCTIONS

//COMMENT BY ADDONSBYDJOT// edited by Addonsbydjot - START
function head(){global $title,$cf,$pth,$tx,$hjs;if($cf['site']['title']!='')$t=$cf['site']['title'].' - '.$title;else $t=$title;$t='<title>'.$t.'</title>';foreach($cf['meta'] as $i=>$k)$t.=meta($i);if($tx['meta']['codepage']!='')$t.=tag('meta http-equiv="content-type" content="text/html;charset='.$tx['meta']['codepage'].'"');return $t.tag('meta name="generator" content="CMSimple 2.4 - www.cmsimple.dk"').tag('link rel="stylesheet" href="'.$pth['file']['stylesheet'].'" title="default" type="text/css" ').$hjs.abdj_CSS('add', '');}
//COMMENT BY ADDONSBYDJOT// edited by Addonsbydjot - END
//COMMENT BY ADDONSBYDJOT// orignial CMSimple code - START
//function head(){global $title,$cf,$pth,$tx,$hjs;if($cf['site']['title']!='')$t=$cf['site']['title'].' - '.$title;else $t=$title;$t='<title>'.$t.'</title>';foreach($cf['meta'] as $i=>$k)$t.=meta($i);if($tx['meta']['codepage']!='')$t.=tag('meta http-equiv="content-type" content="text/html;charset='.$tx['meta']['codepage'].'"');return $t.tag('meta name="generator" content="CMSimple 2.4 - www.cmsimple.dk"').tag('link rel="stylesheet" href="'.$pth['file']['stylesheet'].'" type="text/css"').$hjs;}
//COMMENT BY ADDONSBYDJOT// orignial CMSimple code - END

function sitename(){global $cf;return $cf['site']['title'];}

function onload(){global $onload;return $onload;}

function toc($start,$end){global $hc,$hl,$s,$l;$ta=array();if(isset($start)&&!isset($end))$end=$start;if(!isset($end))$end=3;if(!isset($start))$start=1;for($i=0;$i<$hl;$i++){if($l[$hc[$i]]==1){if($start==1)$ta[]=$hc[$i];$r1=$r2=$i;}if($s==$hc[$i]){$s3=true;for($j=$r1+1;$j<$hl;$j++){if($l[$hc[$j]]==1)break;if($l[$hc[$j]]==2){if($start<3&&$end>1)$ta[]=$hc[$j];$r2=$j;$s3=false;}if($s==$hc[$j]){for($k=$r2+1;$k<$hl;$k++){if($l[$hc[$k]]==3){if($end>2)$ta[]=$hc[$k];}else{$s3=false;break;}}}if($l[$hc[$j]]==3&&$l[$s]==1&&$s3)if($end>2)$ta[]=$hc[$j];}}}return li($ta,$start);}

function li($ta,$st){global $s,$c,$l,$h,$hc,$hl;if(count($ta)==0)return;$t='';if($st=='submenu'||$st=='search')$t.='<ul class="'.$st.'">';$b=0;if($st==1||$st==2||$st==3){$b=$st-1;$st='menulevel';}$j=0;$le=0;$lf[0]=$lf[1]=$lf[2]=$lf[3]=false;for($i=0;$i<$hl;$i++){if(!isset($ta[$j]))break;if($hc[$i]!=$ta[$j])continue;$tf=($s!=$ta[$j]);if($st=='menulevel'||$st=='sitemaplevel'){for($k=(isset($ta[$j-1])?$l[$ta[$j-1]]:$b);$k<$l[$ta[$j]];$k++)$t.='<ul class="'.$st.($k+1).'">';}$t.='<li class="';if(!$tf)$t.='s';$t.='doc';if(isset($hc[$i+1]))if($l[$hc[$i+1]]>$l[$ta[$j]])$t.='s';$t.='">';if($tf)$t.=a($ta[$j],'');$t.=$h[$ta[$j]];if($tf)$t.='</a>';if($st=='menulevel'||$st=='sitemaplevel'){if((isset($ta[$j+1])?$l[$ta[$j+1]]:$b)>$l[$ta[$j]])$lf[$l[$ta[$j]]]=true;else{$t.='</li>';$lf[$l[$ta[$j]]]=false;}for($k=$l[$ta[$j]];$k>(isset($ta[$j+1])?$l[$ta[$j+1]]:$b);$k--){$t.='</ul>';if($lf[$k-1]){$t.='</li>';$lf[$k-1]=false;}};}else $t.='</li>';$j++;}if($st=='submenu'||$st=='search')$t.='</ul>';return $t;}

function searchbox(){global $sn,$tx;return '<form action="'.$sn.'" method="post"><p><input type="text" class="text" name="search" size="17" /></p><p><input type="hidden" name="function" value="search" /></p><p><input type="submit" class="submit" value="'.$tx['search']['button'].'" /></p></form>';}

function sitemaplink(){return ml('sitemap');}

function printlink(){global $f,$search,$file,$sn,$su,$tx;$t=amp().'print';if($f=='search')$t.=amp().'function=search'.amp().'search='.$search;else if($f=='file')$t.=amp().'file='.$file;else if($f!=''&&$f!='save')$t.=amp().$f;return '<a href="'.$sn.'?'.$su.$t.'">'.$tx['menu']['print'].'</a>';}

function mailformlink(){global $cf;if($cf['mailform']['email']!='')return ml('mailform');}

function guestbooklink(){global $cf;if($cf['guestbook']['maxlength']>0)return ml('guestbook');}

function loginlink(){global $cf,$adm,$sn,$u,$s,$tx;if(!$adm){if($cf['security']['wwwaut']!='true')return '<form id="login" action="'.$sn.'" method="post">'.tag('input type="hidden" name="login" value="true"').tag('input type="hidden" name="selected" value="'.$u[$s].'"').tag('input type="hidden" name="passwd" id="passwd" value=""').'</form><a href="javascript:login()">'.$tx['menu']['login'].'</a>';else return a($s,amp().'login').$tx['menu']['login'].'</a>';}}

function lastupdate($br){global $tx,$pth;$t=$tx['lastupdate']['text'].':';if(!(isset($br)))$t.=tag('br');else $t.=' ';return $t.date($tx['lastupdate']['dateformat'], filemtime($pth['file']['content']));}

function locator(){global $title,$h,$s,$f,$c,$l,$hc;if(preg_match("/\#CMSimple hide\#/is",$c[$s]))return $h[$s];if($title!=''&&$h[$s]!=$title)return $title;$t='';$tl=$l[$s];if($tl>1){for($i=$s-1;$i>0 ;$i--){if($l[$i]<$tl){$t=a($i,'').$h[$i].'</a> &gt; '.$t;$tl--;}if($tl<2)break;}}if($s==$hc[0])return $h[$s];else if($s>0)return a($hc[0],'').$h[$hc[0]].'</a> &gt; '.$t.$h[$s];else if($f!='')return ucfirst($f);else return '&nbsp;';}

//COMMENT BY ADDONSBYDJOT// edited by Addonsbydjot - START
function editmenu(){global $adm,$edit,$s,$sn,$tx;if($adm){$t='<table class="edit" width="100%" cellpadding="1" cellspacing="0" border="1"><tr><td align="left">';if($edit)$t.=a($s,amp().'normal').$tx['editmenu']['normal'].'</a>';else $t.=a($s,amp().'edit').$tx['editmenu']['edit'].'</a>';return $t.'</td><td align="center"><a href="'.$sn.'?'.amp().'validate">'.$tx['editmenu']['validate'].'</a></td><td align="center"><a href="'.$sn.'?'.amp().'images">'.$tx['editmenu']['images'].'</a></td><td align="center"><a href="'.$sn.'?'.amp().'downloads">'.$tx['editmenu']['downloads'].'</a></td><td align="center"><a href="'.$sn.'?'.amp().'settings">'.$tx['editmenu']['settings'].'</a></td><td align="center"><a href="'.$sn.'?'.amp().'addonsbydjot'.amp().'abdj_get_admin=1">'.$GLOBALS['abdj_lang']['admin_title_addonsbydjot'].'</a></td><td align="center"><a href="http://www.cmsimple.dk/?User%27s_Manual" target="_blank">'.$tx['editmenu']['help'].'</a></td><td align="right">'.a($s,amp().'logout').$tx['editmenu']['logout'].'</a></td></tr></table>';}}
//COMMENT BY ADDONSBYDJOT// edited by Addonsbydjot - END
//COMMENT BY ADDONSBYDJOT// orignial CMSimple code - START
//function editmenu(){global $adm,$edit,$s,$sn,$tx;if($adm){$t='<table class="edit" width="100%" cellpadding="1" cellspacing="0" border="1"><tr><td align="left">';if($edit)$t.=a($s,amp().'normal').$tx['editmenu']['normal'].'</a>';else $t.=a($s,amp().'edit').$tx['editmenu']['edit'].'</a>';return $t.'</td><td align="center"><a href="'.$sn.'?'.amp().'validate">'.$tx['editmenu']['validate'].'</a></td><td align="center"><a href="'.$sn.'?'.amp().'images">'.$tx['editmenu']['images'].'</a></td><td align="center"><a href="'.$sn.'?'.amp().'downloads">'.$tx['editmenu']['downloads'].'</a></td><td align="center"><a href="'.$sn.'?'.amp().'settings">'.$tx['editmenu']['settings'].'</a></td><td align="center"><a href="http://www.cmsimple.dk/?User%27s_Manual" target="_blank">'.$tx['editmenu']['help'].'</a></td><td align="right">'.a($s,amp().'logout').$tx['editmenu']['logout'].'</a></td></tr></table>';}}
//COMMENT BY ADDONSBYDJOT// orignial CMSimple code - END

function content(){global $s,$o,$c,$edit,$adm;if(!($edit&&$adm)&&$s>-1)return $o.preg_replace("/\#CMSimple.*\#/is","",$c[$s]);else return $o;}

function submenu(){global $s,$c,$cl,$l,$tx;$ta=array();if(!($l[$s]==1||$l[$s]==2))return;$s3=true;for($i=$s+1;$i<$cl;$i++){if($l[$i]==1)break;if($l[$i]==2){if($l[$s]!=1)break;else{$ta[]=$i;$s3=false;}}if($l[$i]==3&&$s3)$ta[]=$i;}if(count($ta)!=0)return '<h4>'.$tx['submenu']['heading'].'</h4>'.li($ta,'submenu');}

function previouspage(){global $hs,$hc,$tx;if(isset($hc[$hs-1]))return a($hc[$hs-1],'').$tx['navigator']['previous'].'<img src=\'images/previous.gif\' alt=\'página anterior diseño web lugo\'></a>';}

function nextpage(){global $hs,$hc,$tx;if(isset($hc[$hs+1])&&$hs>-1)return a($hc[$hs+1],'').$tx['navigator']['next'].'<img src=\'images/next.gif\' alt=\'página siguiente desarrollo web sarria lugo\'></a>';}

function top(){global $tx;return '<a href="#TOP">'.$tx['navigator']['top'].'</a>';}

function languagemenu(){global $pth,$cf,$sl;$t='';$r=array();$fd=@opendir($pth['folder']['base']);while(($p=@readdir($fd))==true ){if(@is_dir($pth['folder']['base'].$p)){if(preg_match('/^[A-z]{2}$/',$p))$r[]=$p;}}if($fd==true)closedir($fd);if(count($r)==0)return '';if($cf['language']['default']!=$sl)$t.='<a href="'.$pth['folder']['base'].'"><img src="'.$pth['folder']['flags'].$cf['language']['default'].'.gif" alt="'.$cf['language']['default'].'" border="0" class="flag" /></a> ';$v=count($r);for($i=0;$i<$v;$i++){if($sl!=$r[$i]){if(is_file($pth['folder']['flags'].'/'.$r[$i].'.gif')){$t.='<a href="'.$pth['folder']['base'].$r[$i].'/"><img src="'.$pth['folder']['flags'].$r[$i].'.gif" alt="'.$r[$i].'" border="0" class="flag" /></a> ';}else{$t.='<a href="'.$pth['folder']['base'].$r[$i].'/">['.$r[$i].']</a> ';}}}return ''.$t.'';}

?>
